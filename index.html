<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>School Students CRUD - Modern</title>

<!-- Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background: #f3f4f6;
        padding: 30px;
    }
    .card {
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .table thead {
        background: #111827;
        color: white;
    }
    .btn-primary {
        background: #1d4ed8;
    }
</style>
</head>
<body>

<div class="container">

    <h1 class="mb-4 fw-bold text-center">ðŸ“˜ School Students â€” Modern CRUD</h1>

    <div class="text-center mb-3">
        <button class="btn btn-success" onclick="loadStudents()">Reload Students</button>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">
            + Add Student
        </button>
    </div>

    <!-- Students Card -->
    <div class="card p-3">
        <table class="table table-bordered table-hover" id="studentsTable">
            <thead>
                <tr>
                    <th>ID</th><th>Name</th><th>Stage</th><th>Class</th>
                    <th>Parent</th><th>Phone</th><th>Address</th>
                    <th>Status</th><th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Add Student Modal -->
<div class="modal fade" id="addModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Student</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        
        <input id="a_name" class="form-control mb-2" placeholder="Full Name">
        <input id="a_stage" class="form-control mb-2" placeholder="Stage Code">
        <input id="a_class" class="form-control mb-2" placeholder="Class Name">
        <input id="a_parent" class="form-control mb-2" placeholder="Parent Name">
        <input id="a_phone" class="form-control mb-2" placeholder="Parent Phone">
        <input id="a_address" class="form-control mb-2" placeholder="Address">

      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="addStudent()">Add</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Student</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">

        <input id="e_id" type="hidden">
        <input id="e_name" class="form-control mb-2" placeholder="Full Name">
        <input id="e_stage" class="form-control mb-2" placeholder="Stage Code">
        <input id="e_class" class="form-control mb-2" placeholder="Class Name">
        <input id="e_parent" class="form-control mb-2" placeholder="Parent Name">
        <input id="e_phone" class="form-control mb-2" placeholder="Parent Phone">
        <input id="e_address" class="form-control mb-2" placeholder="Address">

      </div>
      <div class="modal-footer">
        <button class="btn btn-warning" onclick="updateStudent()">Update</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API = "https://oracleapex.com/ords/mrwebdevcode/school/students";

// Load Students
function loadStudents() {
    fetch(API)
    .then(res => res.json())
    .then(data => {
        let rows = "";
        data.forEach(s => {
            rows += `
            <tr>
                <td>${s.student_id}</td>
                <td>${s.full_name}</td>
                <td>${s.stage_code}</td>
                <td>${s.class_name}</td>
                <td>${s.parent_name}</td>
                <td>${s.parent_phone}</td>
                <td>${s.address}</td>
                <td>${s.status}</td>
                <td>
                    <button class="btn btn-sm btn-warning" onclick='editForm(${JSON.stringify(s)})'>Edit</button>
                    <button class="btn btn-sm btn-danger" onclick='deleteStudent(${s.student_id})'>Delete</button>
                </td>
            </tr>`;
        });
        document.querySelector("#studentsTable tbody").innerHTML = rows;
    })
    .catch(() => alert("API Offline (Oracle Maintenance)"));
}

// Add Student
function addStudent() {
    let body = {
        full_name: document.getElementById("a_name").value,
        stage_code: document.getElementById("a_stage").value,
        class_name: document.getElementById("a_class").value,
        parent_name: document.getElementById("a_parent").value,
        parent_phone: document.getElementById("a_phone").value,
        address: document.getElementById("a_address").value
    };

    fetch(API, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(body)
    })
    .then(() => {
        alert("Student Added");
        loadStudents();
        document.querySelector("#addModal .btn-close").click();
    });
}

// Edit Student Fill Modal
function editForm(s) {
    document.getElementById("e_id").value = s.student_id;
    document.getElementById("e_name").value = s.full_name;
    document.getElementById("e_stage").value = s.stage_code;
    document.getElementById("e_class").value = s.class_name;
    document.getElementById("e_parent").value = s.parent_name;
    document.getElementById("e_phone").value = s.parent_phone;
    document.getElementById("e_address").value = s.address;

    new bootstrap.Modal(document.getElementById("editModal")).show();
}

// Update Student
function updateStudent() {
    let body = {
        student_id: document.getElementById("e_id").value,
        full_name: document.getElementById("e_name").value,
        stage_code: document.getElementById("e_stage").value,
        class_name: document.getElementById("e_class").value,
        parent_name: document.getElementById("e_parent").value,
        parent_phone: document.getElementById("e_phone").value,
        address: document.getElementById("e_address").value
    };

    fetch(API, {
        method: "PUT",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(body)
    })
    .then(() => {
        alert("Updated Successfully");
        loadStudents();
        document.querySelector("#editModal .btn-close").click();
    });
}

// Delete Student
function deleteStudent(id) {
    if (!confirm("Are you sure you want to delete this student?")) return;

    fetch(API, {
        method: "DELETE",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ student_id: id })
    })
    .then(() => {
        alert("Deleted");
        loadStudents();
    });
}
</script>

</body>
</html>
